<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Document Analyzer</title>
  <link rel="stylesheet" href="style.css" />
</head>

<body>
  <main class="container">
    <header class="header">
      <h1>Document Analyzer</h1>
      <p class="subtle">Upload a document, choose outputs, and optionally add cross-reference documents.</p>
    </header>

    <!-- Document Library Section -->
    <section class="card">
      <h2 class="section-title">Document Library</h2>
      <p class="subtle" style="margin-bottom: 1rem;">Upload documents or scan the server's documents folder, then process them for Q&A.</p>

      <!-- Upload Form -->
      <div class="upload-section">
        <h3>Upload Document</h3>
        <div class="upload-form">
          <div class="upload-row">
            <input type="file" id="uploadFileInput" accept=".pdf,.docx" />
            <input type="text" id="uploadFolderInput" placeholder="Folder (optional)" class="folder-input" />
            <button id="uploadBtn" type="button" class="btn-primary">Upload</button>
          </div>
          <p class="hint">Supported formats: PDF, DOCX (max 10MB)</p>
        </div>
      </div>

      <div class="library-divider"></div>

      <div class="library-actions">
        <button id="scanBtn" type="button" class="btn-secondary">Scan Server Folder</button>
        <button id="processAllBtn" type="button" class="btn-secondary">Process All</button>
        <span id="embeddingStatus" class="embedding-status"></span>
      </div>

      <div id="libraryStatus" class="status" style="margin-top: 1rem; display: none;"></div>

      <div id="documentList" class="document-list">
        <p class="subtle">No documents found. Upload a document or scan the server folder.</p>
      </div>

      <!-- Q&A Section -->
      <div class="qa-section">
        <h3>Ask a Question</h3>
        <p class="hint">Select documents above, then ask a question to search through them.</p>

        <div class="field">
          <textarea id="questionInput" rows="3" placeholder="Type your question here..."></textarea>
        </div>

        <div class="actions">
          <button id="askBtn" type="button" disabled>Ask Question</button>
        </div>

        <div id="qaStatus" class="status" style="margin-top: 1rem; display: none;"></div>

        <div id="answerSection" class="answer-section" style="display: none;">
          <h4>Answer</h4>
          <div id="answerContent" class="answer-content"></div>

          <div id="sourcesSection" style="display: none;">
            <h5>Sources</h5>
            <div id="sourcesList" class="sources-list"></div>
          </div>
        </div>
      </div>
    </section>

    <!-- Original Analyze Section -->
    <section class="card">
      <h2 class="section-title">Document Analysis</h2>
      <form id="analyzeForm">
        <div class="field">
          <label for="fileInput">Main document (PDF or DOCX)</label>
          <input id="fileInput" type="file"
            accept=".pdf,.docx,application/pdf,application/vnd.openxmlformats-officedocument.wordprocessingml.document"
            required />
          <p class="hint">Tip: Start with short docs to reduce token usage.</p>
        </div>

        <div class="field">
          <label>Outputs (choose at least 1)</label>
          <div class="checks" id="outputs">
            <label class="check">
              <input type="checkbox" name="outputs" value="translation" checked />
              <span>Full translation</span>
            </label>
            <label class="check">
              <input type="checkbox" name="outputs" value="summary" checked />
              <span>Summary</span>
            </label>
            <label class="check">
              <input type="checkbox" name="outputs" value="key_points" />
              <span>Key points</span>
            </label>
            <label class="check">
              <input type="checkbox" name="outputs" value="todos" />
              <span>Department to-do list</span>
            </label>
            <label class="check">
              <input type="checkbox" name="outputs" value="cross_reference" />
              <span>Cross-reference</span>
            </label>
            <label class="check">
              <input type="checkbox" name="outputs" value="generate_template" />
              <span>Generate response template</span>
            </label>
          </div>
          <p class="hint">
            Cross-reference searches for answers in the additional documents and reports findings.
          </p>
        </div>

        <!-- Pre-fill option - shown only when "Generate response template" is checked -->
        <div class="field" id="prefillField" style="display: none;">
          <label class="check prefill-check">
            <input type="checkbox" id="templateFillToggle" />
            <span>Pre-fill response template from cross-reference documents</span>
          </label>
          <p class="hint">When enabled, the response template will be automatically filled with data found in cross-reference documents instead of using placeholders.</p>
        </div>

        <div class="field">
          <label for="translateTo">Translate to</label>
          <select id="translateTo" required>
            <option value="English">English</option>
            <option value="Polish">Polish</option>
            <option value="German">German</option>
            <option value="French">French</option>
            <option value="Spanish">Spanish</option>
          </select>
        </div>

        <div class="field" id="crossFilesField">
          <label for="crossFiles">Cross-reference documents (optional, multiple)</label>
          <input id="crossFiles" type="file" multiple
            accept=".pdf,.docx,application/pdf,application/vnd.openxmlformats-officedocument.wordprocessingml.document" />
          <p class="hint">These documents are used for cross-reference lookups and to pre-fill response templates.</p>
        </div>

        <div class="actions">
          <button id="analyzeBtn" type="submit" disabled>Analyze</button>
          <button id="clearBtn" type="button">Clear</button>
        </div>

        <div id="status" class="status">Choose at least one output to enable Analyze.</div>
      </form>
    </section>

    <!-- Results card - hidden by default -->
    <section class="card" id="resultsCard" style="display: none;">

      <!-- Translation result - hidden by default -->
      <div class="result-block" id="translationBlock" style="display: none;">
        <details class="disclosure" id="translatedDisclosure" open>
          <summary>
            <span>Translated document</span>
            <span class="subtle">Click to expand/collapse</span>
          </summary>
          <div style="margin-top:10px;">
            <div class="result-actions">
              <button id="exportTranslationBtn" type="button" class="btn-export">Export</button>
            </div>
            <div id="translatedDoc" class="result-box subtle" style="margin-top:10px;">No data yet.</div>
          </div>
        </details>
      </div>

      <!-- Summary result - hidden by default -->
      <div class="result-block" id="summaryBlock" style="display: none;">
        <h3>Summary</h3>
        <div id="summary" class="result-box subtle">No data yet.</div>
      </div>

      <!-- Key points result - hidden by default -->
      <div class="result-block" id="keyPointsBlock" style="display: none;">
        <h3>Key points</h3>
        <div id="keyPoints" class="result-box subtle">No data yet.</div>
      </div>

      <!-- Todos result - hidden by default -->
      <div class="result-block" id="todosBlock" style="display: none;">
        <h3>To-dos by department</h3>
        <div class="result-actions">
          <button id="exportTodosBtn" type="button" class="btn-export">Export</button>
        </div>
        <div id="todos" class="result-box subtle" style="margin-top:10px;">No data yet.</div>
      </div>

      <!-- Cross-reference result - hidden by default -->
      <div class="result-block" id="crossRefBlock" style="display: none;">
        <h3>Cross-reference</h3>
        <div id="crossRef" class="result-box subtle">No data yet.</div>
      </div>

      <!-- Response template result - hidden by default -->
      <div class="result-block" id="templateBlock" style="display: none;">
        <h3>Response template</h3>
        <div class="result-actions">
          <button id="exportTemplateBtn" type="button" class="btn-export">Export</button>
        </div>
        <div id="templateBox" class="result-box subtle" style="margin-top:10px;">No data yet.</div>
      </div>

    </section>
  </main>

  <script src="app.js"></script>
</body>
</html>

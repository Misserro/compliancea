<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Document Analyzer</title>
  <link rel="stylesheet" href="style.css" />
</head>

<body>
  <main class="container">
    <header class="header">
      <h1>Document Analyzer</h1>
    </header>

    <!-- Tab Navigation -->
    <nav class="tab-nav">
      <button class="tab-btn active" data-tab="library">Document Library</button>
      <button class="tab-btn" data-tab="analyzer">Document Analyzer</button>
      <button class="tab-btn" data-tab="desk">Desk</button>
      <button class="tab-btn" data-tab="statistics">Statistics</button>
    </nav>

    <!-- Tab 1: Document Library -->
    <section class="tab-content active" id="tab-library">
      <div class="card">
        <h2 class="section-title">Document Library</h2>
        <p class="subtle" style="margin-bottom: 1rem;">Upload and manage documents for Q&A and cross-referencing.</p>

        <!-- Upload Form -->
        <div class="upload-section">
          <h3>Upload Document</h3>
          <div class="upload-form">
            <div class="upload-row">
              <input type="file" id="uploadFileInput" accept=".pdf,.docx" />
              <select id="uploadCategoryInput" class="category-input">
                <option value="">No Category</option>
                <option value="Finance">Finance</option>
                <option value="Compliance">Compliance</option>
                <option value="Operations">Operations</option>
                <option value="HR">HR</option>
                <option value="Board">Board</option>
                <option value="IT">IT</option>
              </select>
              <button id="uploadBtn" type="button" class="btn-primary">Upload</button>
            </div>
            <p class="hint">Supported formats: PDF, DOCX (max 10MB)</p>
          </div>
        </div>

        <div class="library-divider"></div>

        <div class="library-actions">
          <button id="scanBtn" type="button" class="btn-secondary">Scan Server Folder</button>
          <button id="processAllBtn" type="button" class="btn-secondary">Process All</button>
          <span id="embeddingStatus" class="embedding-status"></span>
        </div>

        <div id="libraryStatus" class="status" style="margin-top: 1rem; display: none;"></div>

        <div id="documentList" class="document-list">
          <p class="subtle">No documents found. Upload a document or scan the server folder.</p>
        </div>
      </div>
    </section>

    <!-- Tab 2: Document Analyzer -->
    <section class="tab-content" id="tab-analyzer">
      <div class="card">
        <h2 class="section-title">Document Analyzer</h2>
        <p class="subtle" style="margin-bottom: 1rem;">Translate, summarize, and extract key information from documents.</p>

        <form id="analyzeForm">
          <div class="field">
            <label for="analyzerFileInput">Document (PDF or DOCX)</label>
            <input id="analyzerFileInput" type="file"
              accept=".pdf,.docx,application/pdf,application/vnd.openxmlformats-officedocument.wordprocessingml.document"
              required />
          </div>

          <div class="field">
            <label>Outputs (choose at least 1)</label>
            <div class="checks" id="analyzerOutputs">
              <label class="check">
                <input type="checkbox" name="analyzerOutputs" value="translation" checked />
                <span>Full translation</span>
              </label>
              <label class="check">
                <input type="checkbox" name="analyzerOutputs" value="summary" checked />
                <span>Summary</span>
              </label>
              <label class="check">
                <input type="checkbox" name="analyzerOutputs" value="key_points" />
                <span>Key points</span>
              </label>
              <label class="check">
                <input type="checkbox" name="analyzerOutputs" value="todos" />
                <span>Department to-do list</span>
              </label>
            </div>
          </div>

          <div class="field">
            <label for="analyzerTranslateTo">Translate to</label>
            <select id="analyzerTranslateTo" required>
              <option value="English">English</option>
              <option value="Polish">Polish</option>
              <option value="German">German</option>
              <option value="French">French</option>
              <option value="Spanish">Spanish</option>
            </select>
          </div>

          <div class="actions">
            <button id="analyzeBtn" type="submit" disabled>Analyze</button>
            <button id="analyzerClearBtn" type="button">Clear</button>
          </div>

          <div id="analyzerStatus" class="status">Choose at least one output to enable Analyze.</div>
        </form>
      </div>

      <!-- Analyzer Results -->
      <section class="card" id="analyzerResultsCard" style="display: none;">
        <div class="result-block" id="analyzerTranslationBlock" style="display: none;">
          <details class="disclosure" id="analyzerTranslatedDisclosure" open>
            <summary>
              <span>Translated document</span>
              <span class="subtle">Click to expand/collapse</span>
            </summary>
            <div style="margin-top:10px;">
              <div class="result-actions">
                <button id="exportAnalyzerTranslationBtn" type="button" class="btn-export">Export</button>
              </div>
              <div id="analyzerTranslatedDoc" class="result-box subtle" style="margin-top:10px;">No data yet.</div>
            </div>
          </details>
        </div>

        <div class="result-block" id="analyzerSummaryBlock" style="display: none;">
          <h3>Summary</h3>
          <div id="analyzerSummary" class="result-box subtle">No data yet.</div>
        </div>

        <div class="result-block" id="analyzerKeyPointsBlock" style="display: none;">
          <h3>Key points</h3>
          <div id="analyzerKeyPoints" class="result-box subtle">No data yet.</div>
        </div>

        <div class="result-block" id="analyzerTodosBlock" style="display: none;">
          <h3>To-dos by department</h3>
          <div class="result-actions">
            <button id="exportAnalyzerTodosBtn" type="button" class="btn-export">Export</button>
          </div>
          <div id="analyzerTodos" class="result-box subtle" style="margin-top:10px;">No data yet.</div>
        </div>
      </section>
    </section>

    <!-- Tab 3: Desk -->
    <section class="tab-content" id="tab-desk">
      <div class="card">
        <h2 class="section-title">Desk</h2>
        <p class="subtle" style="margin-bottom: 1rem;">Ask questions, cross-reference external documents, and generate response templates.</p>

        <!-- Q&A Section -->
        <div class="desk-section">
          <h3>Ask a Question</h3>
          <p class="hint">Select documents from your library to search through.</p>

          <div class="field">
            <div class="field-header">
              <label>Select Library Documents</label>
              <button type="button" id="qaSelectAllBtn" class="btn-select-all">Select All</button>
            </div>
            <div id="deskDocumentSelect" class="document-select-list">
              <p class="subtle">Loading documents...</p>
            </div>
          </div>

          <div class="field">
            <textarea id="questionInput" rows="3" placeholder="Type your question here..."></textarea>
          </div>

          <div class="actions">
            <button id="askBtn" type="button" disabled>Ask Question</button>
          </div>

          <div id="qaStatus" class="status" style="margin-top: 1rem; display: none;"></div>

          <div id="answerSection" class="answer-section" style="display: none;">
            <h4>Answer</h4>
            <div id="answerContent" class="answer-content"></div>

            <div id="sourcesSection" style="display: none;">
              <h5>Sources</h5>
              <div id="sourcesList" class="sources-list"></div>
            </div>
          </div>
        </div>

        <div class="library-divider"></div>

        <!-- Cross-Reference & Template Section -->
        <div class="desk-section">
          <h3>Cross-Reference & Response Template</h3>
          <p class="hint">Upload external documents to analyze and generate response templates. Optionally cross-reference with library documents.</p>

          <div class="field">
            <label for="deskExternalFile">External Document (PDF or DOCX)</label>
            <input id="deskExternalFile" type="file"
              accept=".pdf,.docx,application/pdf,application/vnd.openxmlformats-officedocument.wordprocessingml.document" />
            <p class="hint">This is the document you want to respond to.</p>
          </div>

          <div class="field">
            <label>Outputs</label>
            <div class="checks" id="deskOutputs">
              <label class="check">
                <input type="checkbox" name="deskOutputs" value="cross_reference" />
                <span>Cross-reference findings</span>
              </label>
              <label class="check">
                <input type="checkbox" name="deskOutputs" value="generate_template" checked />
                <span>Generate response template</span>
              </label>
            </div>
          </div>

          <div class="field" id="deskPrefillField">
            <label class="check prefill-check">
              <input type="checkbox" id="deskPrefillToggle" />
              <span>Pre-fill response template with data from library documents</span>
            </label>
            <p class="hint">When enabled, the template will be automatically filled with data found in your library documents.</p>
          </div>

          <div class="field" id="deskCrossRefField">
            <div class="field-header">
              <label>Select Library Documents <span class="hint-inline">(required for cross-reference or pre-fill)</span></label>
              <button type="button" id="crossRefSelectAllBtn" class="btn-select-all">Select All</button>
            </div>
            <div id="deskCrossRefSelect" class="document-select-list categorized">
              <p class="subtle">Loading documents...</p>
            </div>
          </div>

          <div class="field">
            <label for="deskTranslateTo">Output language</label>
            <select id="deskTranslateTo">
              <option value="English">English</option>
              <option value="Polish">Polish</option>
              <option value="German">German</option>
              <option value="French">French</option>
              <option value="Spanish">Spanish</option>
            </select>
          </div>

          <div class="actions">
            <button id="deskAnalyzeBtn" type="button" disabled>Analyze & Generate</button>
            <button id="deskClearBtn" type="button">Clear</button>
          </div>

          <div id="deskStatus" class="status" style="display: none;"></div>
        </div>
      </div>

      <!-- Desk Results -->
      <section class="card" id="deskResultsCard" style="display: none;">
        <div class="result-block" id="deskCrossRefBlock" style="display: none;">
          <h3>Cross-reference Findings</h3>
          <div id="deskCrossRef" class="result-box subtle">No data yet.</div>
        </div>

        <div class="result-block" id="deskTemplateBlock" style="display: none;">
          <h3>Response Template</h3>
          <div class="result-actions">
            <button id="exportDeskTemplateBtn" type="button" class="btn-export">Export</button>
          </div>
          <div id="deskTemplateBox" class="result-box subtle" style="margin-top:10px;">No data yet.</div>
        </div>
      </section>
    </section>

    <!-- Tab 4: Statistics -->
    <section class="tab-content" id="tab-statistics">
      <div class="card">
        <h2 class="section-title">Statistics</h2>
        <p class="subtle" style="margin-bottom: 1rem;">View token usage from your last action.</p>

        <div id="statsContent">
          <div class="stats-empty">
            <p class="subtle">No statistics available yet. Perform an action (ask a question, analyze a document, or use the desk) to see token usage.</p>
          </div>
        </div>

        <div class="stats-info">
          <h3>Token Pricing Reference</h3>
          <div class="pricing-table">
            <div class="pricing-row">
              <span class="pricing-service">Claude (Sonnet)</span>
              <span class="pricing-detail">Input: $3.00 / 1M tokens | Output: $15.00 / 1M tokens</span>
            </div>
            <div class="pricing-row">
              <span class="pricing-service">Voyage AI (voyage-3-lite)</span>
              <span class="pricing-detail">$0.02 / 1M tokens</span>
            </div>
          </div>
          <p class="hint" style="margin-top: 1rem;">
            Token counts are estimates. Claude tokens are reported directly from the API.
            Voyage AI tokens are estimated as ~1 token per 4 characters.
          </p>
        </div>
      </div>
    </section>
  </main>

  <script src="app.js"></script>
</body>
</html>
